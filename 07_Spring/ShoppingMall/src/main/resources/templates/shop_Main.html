<!DOCTYPE html>
<!-- 
	페이지마다 면화하는 내용을 보여주기 위한 레이아웃을 설정하기 위해 필요한 설정.
	layout:decorate="~{레이아웃폴더/html명}"
-->
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layouts/shopping}">
<head>
	<meta charset="UTF-8">
	<title>Insert title here</title>
	<th:block layout:fragment="script">
		<script th:inline="javascript">
	        $(document).ready(function(){
	            $("#searchBtn").on("click",function(e) {
	                e.preventDefault();
	                page(0);
	            });
	        });
	
	        function page(page){
	            var searchDateType = $("#searchDateType").val();
	            var searchSellStatus = $("#searchSellStatus").val();
	            var searchBy = $("#searchBy").val();
	            var searchQuery = $("#searchQuery").val();
	
	            location.href="/" + page + "?&searchQuery=" + searchQuery;
	        }
		</script>
	</th:block>
</head>
<body>
	<!--
		layout:fragment="이름" 으로 지정해서 내용을 다르게 작성할 수 있다...
		같은 이름으로 여러개의 본문내용을 담은 태그를 작성해서 바꿔끼는건 상상할 수 있는데, 이거 어떤 본문을 표시할지는 어떻게...
		아 컨트롤러에서 여기로 들어오고는 이 본문을 가지고 page01 을 표현하니까 그거 컨트롤러에서 조절할 수 있겠구나.
	-->
	<div layout:fragment="section">
		<section class="card">
			<div class="card-body" sec:authorize="isAnonymous()">
				비로그인 상태
			</div>
			<!--
				hasRole() 과 hasAuthority() 는 역할과 권한의 표현차이가 있을 뿐 기본적인 기능으로써는 유사하다.
				isAuthenticated() 는 권한을 가진 모든 사용자를 의미하니까 USER 와 ADMIN을 포함한다.
				권한은 계층적인 구조? 라고 생각하면 되려나
				특정 권한에서만 특정 페이지를 보이게하려면 권한을 지정해줘야함.
			-->
			<div class="card-body" sec:authorize="hasRole('USER')">
				일반 회원 [ <span th:text="${User}"></span> ] 로그인 상태
			</div>		
			<div class="card-body" sec:authorize="hasAnyAuthority('ROLE_ADMIN')">
				관리자 [ <span th:text="${User}"></span> ]로그인 상태
			</div>		
		</section>
		<section>
			<form th:action="@{'/' + ${items.number}}" role="form" method="get" th:object="${items}">
				<div class="d-flex flex-row justify-content-evenly flex-wrap">
					<div class="card" style="width: 30%" th:each="item, status : ${items.getContent()}">
						<img class="card-img-top" alt="" th:src="${item.imgUrl}">
						<div class="card-body">
							<h5 class="card-title" th:text="${item.itemName}"></h5>
							<p class="card-text" th:text="${item.itemDetail}"></p>
							<p class="card-text" th:text="${item.price} + '원'"></p>
						</div>
					</div>				
				</div>
				<nav aria-label="Page navigation example" th:with="start = ${(items.number/maxPage)*maxPage + 1}, 
																		   end = ${(items.totalPages == 0) ? 1 : (start + (maxPage - 1) < items.totalPages ? start + (maxPage - 1) : items.totalPages)}">
					<ul class="pagination d-flex justify-content-center">
						<!-- 타임리프:classappend 위치한 태그에 클래스를 추가해준다. 삼항연산자 같은 함수도 사용할 수 있네-->
						<li class="page-item" th:classappend="${items.first} ? 'disabled'" >
							<a class="page-link" th:onclick="'javascript:page(' + ${items.number - 1} + ')'">
						    	<span aria-hidden="true">&laquo;</span>
						    </a>
						</li>
						<li class="page-item" th:each="page: ${#numbers.sequence(start, end)}" th:classappend="${items.number eq page-1} ? 'active' : ''">
							<!-- 위의 자바스크립트를 호출한다. 객체의 페이지는 0부터 시작하기 때문에 -1 값을 보내야함 -->
						    <a class="page-link" th:onclick="'javascript:page(' + ${page -1} + ')'" th:inline="text">[[${page}]]</a>
						</li>
						<li class="page-item" th:classappend="${items.last} ? 'disabled'">
						    <a class="page-link" th:onclick="'javascript:page(' + ${items.number + 1} + ')'">
								<span aria-hidden="true">&raquo;</span>
						    </a>
						</li>
					</ul>
				</nav>
				<div class="d-flex justify-content-center" style="height: 40px" th:object="${itemSearchDTO}">
					<input type="text" class="form-control" placeholder="검색어 입력" style="width: auto" th:field="*{searchQuery}">
					<button type="submit" class="btn btn-primary mb-3" id="searchBtn" style="height: 100%">Find</button>						
				</div>			
			</form>
		</section>
	</div>
</body>
</html>